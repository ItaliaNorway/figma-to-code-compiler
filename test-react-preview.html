<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Preview Test - Design System Loading</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .loading { background: #fff3cd; color: #856404; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .preview-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-top: 20px;
            min-height: 200px;
        }
        h1 { color: #333; }
        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üß™ React Preview Test</h1>
    <p>Testing if @redcross/design-system can be loaded from esm.sh</p>
    
    <div id="react-status" class="status loading">‚è≥ Loading React...</div>
    <div id="ds-status" class="status loading">‚è≥ Loading Design System...</div>
    <div id="css-status" class="status loading">‚è≥ Loading CSS...</div>
    
    <h2>Preview Container</h2>
    <div id="preview" class="preview-container">
        <p style="color: #888;">Components will render here...</p>
    </div>
    
    <h2>Console Log</h2>
    <pre id="log"></pre>

    <script type="module">
        const log = (msg, type = 'info') => {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logEl.textContent += `[${time}] ${msg}\n`;
            console.log(msg);
        };

        const setStatus = (id, success, msg) => {
            const el = document.getElementById(id);
            el.className = `status ${success ? 'success' : 'error'}`;
            el.textContent = msg;
        };

        // Step 1: Load React
        log('Loading React from esm.sh...');
        try {
            const React = await import('https://esm.sh/react@18');
            const ReactDOM = await import('https://esm.sh/react-dom@18/client');
            window.React = React;
            window.ReactDOM = ReactDOM;
            setStatus('react-status', true, '‚úÖ React loaded successfully');
            log('React version: ' + React.version);
        } catch (err) {
            setStatus('react-status', false, '‚ùå React failed: ' + err.message);
            log('React error: ' + err.message, 'error');
        }

        // Step 2: Try loading design system CSS
        log('Loading design system CSS...');
        try {
            // Try common CSS paths
            const cssUrls = [
                'https://unpkg.com/rk-designsystem/dist/styles.css',
                'https://cdn.jsdelivr.net/npm/rk-designsystem/dist/styles.css',
                'https://unpkg.com/rk-designsystem/dist/componentlibrary.css'
            ];
            
            let cssLoaded = false;
            for (const url of cssUrls) {
                try {
                    const link = document.createElement('link');
                    link.rel = 'stylesheet';
                    link.href = url;
                    document.head.appendChild(link);
                    log('Trying CSS: ' + url);
                    cssLoaded = true;
                    break;
                } catch (e) {
                    log('CSS not found at: ' + url);
                }
            }
            setStatus('css-status', cssLoaded, cssLoaded ? '‚úÖ CSS link added (check if styles apply)' : '‚ö†Ô∏è CSS paths tried, check manually');
        } catch (err) {
            setStatus('css-status', false, '‚ùå CSS failed: ' + err.message);
            log('CSS error: ' + err.message, 'error');
        }

        // Step 3: Try loading design system components
        log('Trying multiple CDN sources for rk-designsystem...');
        
        // Note: rk-designsystem has complex dependencies (@digdir/designsystemet, etc.)
        // that CDN services cannot resolve on-the-fly
        const cdnSources = [
            { name: 'jsdelivr direct ES module', url: 'https://cdn.jsdelivr.net/npm/rk-designsystem@1.1.109/dist/componentlibrary.es.js', timeout: 5000 }
        ];
        
        let DS = null;
        for (const source of cdnSources) {
            try {
                log(`Trying ${source.name}: ${source.url}`);
                DS = await import(source.url);
                log(`‚úÖ Loaded from ${source.name}`);
                break;
            } catch (err) {
                log(`‚ùå ${source.name} failed: ${err.message}`);
            }
        }
        
        if (DS) {
            window.DesignSystem = DS;
            const componentNames = Object.keys(DS).filter(k => typeof DS[k] === 'function');
            setStatus('ds-status', true, `‚úÖ Design System loaded! Components: ${componentNames.slice(0, 5).join(', ')}${componentNames.length > 5 ? '...' : ''}`);
            log('Available components: ' + componentNames.join(', '));
            
            // Try to render a component
            if (DS.Heading && window.React && window.ReactDOM) {
                log('Attempting to render Heading component...');
                const container = document.getElementById('preview');
                container.innerHTML = '';
                
                const root = window.ReactDOM.createRoot(container);
                root.render(
                    window.React.createElement(DS.Heading, { as: 'h1' }, 'Hello from Design System!')
                );
                log('‚úÖ Heading component rendered!');
            } else if (componentNames.length > 0) {
                log('Heading not found, available: ' + componentNames.join(', '));
            }
        } else {
            setStatus('ds-status', false, '‚ùå Design System failed: All CDN sources failed');
            log('All CDN sources failed. The package may need to be self-hosted.');
        }
    </script>
</body>
</html>
